<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
<meta name="format-detection" content="telephone=no" />
<block name="title">
<title>汉高微信后台管理</title>
</block>
<link href="/res/css/bootstrap.min.css" rel="stylesheet">
<link href="/res/css/font-awesome.css" rel="stylesheet">
<link href="/res/css/mydialog.css" rel="stylesheet">
<link href="/res/css/form.css" rel="stylesheet">
<style type="text/css">
body {
	padding: 5px;
}

.wrapper {
	max-width: 600px;
	margin: 0 auto 20px auto;
}
</style>
</head>
<body>
	<form class="clearfix wrapper">
		<block name="subject">
		<h3>修改</h3>
		</block>
		<div id="itemedit">
			<php>$k=0;</php>
			<block name="edit_ui"></block>
		</div>
		<div class="clearfix">
			<button type="button" class="btn btn-primary pull-right" id="btnsave">
				<i class="fa fa-save">&nbsp;保&nbsp;存</i>
			</button>
		</div>
	</form>
	<script type="text/javascript" src="/res/js/jquery.min.js"></script>
	<script type="text/javascript" src="/res/js/mycore.js"></script>
	<script type="text/javascript" src="/res/js/mydialog.js"></script>
	<script type="text/javascript" src="/res/js/formvals.js"></script>
	<script type="text/javascript">
	$(function() {
		var fmignore = {};
		var data={$data};
		$('#itemedit').find('*[cid]').each(function() {
			var cid=$(this).attr('cid');
			if(typeof data.item[cid] == 'undefined'){
				return true;
			}
			var name = $(this).get(0).tagName.toLowerCase();
			switch(name){
			case 'input':
				var tp = $(this).attr('type');
				if (tp) {
					tp = tp.toLowerCase();
				}
				if (tp == 'checkbox' || tp == 'radio') {
				} else {
					$(this).val(data.item[cid]);
				}
				break;
			case 'textarea':
			case 'select':
				$(this).val(data.item[cid]);
				break;
			default :
				break;
			}
		});

		$('#btnsave').on('click',function(e){
			var pdata={};
			$.formvals($('#itemedit'),'cid',pdata);
			for(var k in pdata){
				if(pdata[k] === '' && !fmignore[k]){
					var anchor=$('#itemedit').find('.anchor_'+k);
					$(window).scrollTop(anchor.offset().top - 60);
					anchor.poptip('请输入信息');
					anchor.trigger('focus');
					return false;
				}
			}
			pdata[data.idkey]=data[data.idkey];
			var turl='{$url.save}';
			$.ajaxExt(turl,pdata,function(jo){
				if(jo.isOk()){
					if(data[data.idkey] > 0){
						$('#btnsave').poptip('保存成功', true);
					}else{
						window.location.replace('{$url.addok}'+jo.tid);
					}
				}else{
					$.alert(jo.getMessage());
				}
			});
		});
	});
	</script>
</body>
</html>